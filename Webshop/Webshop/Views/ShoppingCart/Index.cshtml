@model IEnumerable<ShoppingCartModel>
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Xsrf
@functions{
    public string GetAntiXsrfRequestToken()
    {
        return Xsrf.GetAndStoreTokens(Context).RequestToken;
    }
}
@{
    ViewData["Title"] = "Din Varukorg";
}


@if (TempData["LoginNeeded"] != null)

{
    <div class="alert alert-warning" role="alert">
        @TempData["LoginNeeded"] Klicka <a asp-action="Login" asp-controller="User">här</a> för att logga in
    </div>
}


<h3 class="mt-3 mb-3">Kundvagnen</h3>
<hr />

@if (Model != null && Model.Count() > 0)
{

    <table class="table table-responsive-xs table-responsive-sm table-borderless text-white mx-auto" id="CartContent" style="border-collapse: separate; border-spacing: 0px 1px">
        @foreach (var product in Model)
        {
            <tr id="DumpCrap_@product.ShoppingCartId" style="background-color: rgba(255, 255, 255, 0.08); border-radius: 4px">
                <td style="max-width: 80px">
                    <a asp-action="ProductDetail" asp-controller="Product" asp-route-id="@product.ProductId">
                        <img src="@Url.Content("~/Image/" + product.Photo)" alt="@product.Name" style="object-fit: contain; height: 60px; width: 80px; background-color: #fff" class="rounded" />
                    </a>
                </td>
                <td style="vertical-align: middle">
                    <a asp-action="ProductDetail" asp-controller="Product" asp-route-id="@product.ProductId">@product.Name
                        </a>
                    </td>
                <td style="vertical-align: middle; text-align: center">
                    @if (product.Discount == 0)
                    {
                        <span style="color: #7fe095">@product.Price.ToString("C0")</span>
                    }
                    else
                    {
                        <div style="text-decoration: line-through; font-size: small">@product.Price.ToString("C0")</div>
                        <div style="color: #7fe095">@product.DiscountPrice.ToString("C0")</div>
                    }
                </td>

                <td style="vertical-align: middle; width: 24px">
                    @if (@product.Amount == 0)
                    {
                        <button onclick="RemoveCrapFromCart(@product.ShoppingCartId, @product.ProductId)" id="DecreaseBtn_@product.ProductId" disabled style="background-color: transparent; border: none; outline: none; color: #fff"><i class="fas fa-minus-circle"></i></button>
                    }
                    else
                    {
                        <button onclick="RemoveCrapFromCart(@product.ShoppingCartId, @product.ProductId)" id="DecreaseBtn_@product.ProductId" style="background-color: transparent; border: none; outline: none; color: #fff"><i class="fas fa-minus-circle"></i></button>
                    }
                </td>
                <td style="vertical-align: middle; text-align: center; width: 24px" class="productCounter" id="cartProductId_@product.ProductId">@product.Amount</td>
                <td style="vertical-align: middle; width: 24px"><button onclick="AddCrapToCart(@product.ProductId, null)" id="IncreaseBtn_@product.ProductId" style="background-color: transparent; border: none; outline: none; color: #7fe095"><i class="fas fa-plus-circle"></i></button></td>
                <td style="vertical-align: middle; width: 24px"><button onclick="DeleteCrapFromCart(@product.ShoppingCartId)" style="background-color: transparent; border: none; outline: none; color: #fff"><i class="fas fa-trash-alt"></i></button></td>
            </tr>
        }
        <tr>
            <td colspan="7">
                <a class="btn btn-dark float-left text-white" asp-controller="Product" asp-action="AllProducts"><i class="fas fa-caret-left"></i> Fortsätt Shoppa snålis</a>
                @if (Model.Any(x => x.Amount > 0))
                {
                    <button class="btn btn-success float-right" id="CashOut" onclick="location.href = '/order'">Gå vidare till kassan <i class="fas fa-caret-right"></i></button>
                }
                else
                {
                    <button class="btn btn-success float-right" id="CashOut" onclick="location.href = '/order'" disabled>Gå vidare till kassan <i class="fas fa-caret-right"></i></button>
                }
            </td>
        </tr>
    </table>

    @* Fetched by AJAX *@
    <div style="display: none" id="AntiForgeryToken">@GetAntiXsrfRequestToken()</div>

    @*<a class="btn btn-dark float-left" asp-controller="Product" asp-action="AllProducts">Fortsätt Shoppa snålis</a>
    @if (Model.Any(x => x.Amount > 0))
    {
        <button class="btn btn-success float-right" id="CashOut" onclick="location.href = '/order'">Gå till kassan</button>
    }
    else
    {
        <button class="btn btn-success float-right" id="CashOut" onclick="location.href = '/order'" disabled>Gå till kassan</button>
    }*@
}
else
{
    <div class="alert alert-warning" role="alert">
        Din varuvagn är tom
    </div>
}